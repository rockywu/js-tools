/*! 
 * jstools 
 * jstools.js use mobel async data load   
 * 2015-08-12 
 */
function JPEGEncoder(a){function b(a){for(var b=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],c=0;64>c;c++){var d=y((b[c]*a+50)/100);1>d?d=1:d>255&&(d=255),z[P[c]]=d}for(var e=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],f=0;64>f;f++){var g=y((e[f]*a+50)/100);1>g?g=1:g>255&&(g=255),A[P[f]]=g}for(var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],i=0,j=0;8>j;j++)for(var k=0;8>k;k++)B[i]=1/(z[P[i]]*h[j]*h[k]*8),C[i]=1/(A[P[i]]*h[j]*h[k]*8),i++}function c(a,b){for(var c=0,d=0,e=new Array,f=1;16>=f;f++){for(var g=1;g<=a[f];g++)e[b[d]]=[],e[b[d]][0]=c,e[b[d]][1]=f,d++,c++;c*=2}return e}function d(){t=c(Q,R),u=c(U,V),v=c(S,T),w=c(W,X)}function e(){for(var a=1,b=2,c=1;15>=c;c++){for(var d=a;b>d;d++)E[32767+d]=c,D[32767+d]=[],D[32767+d][1]=c,D[32767+d][0]=d;for(var e=-(b-1);-a>=e;e++)E[32767+e]=c,D[32767+e]=[],D[32767+e][1]=c,D[32767+e][0]=b-1+e;a<<=1,b<<=1}}function f(){for(var a=0;256>a;a++)O[a]=19595*a,O[a+256>>0]=38470*a,O[a+512>>0]=7471*a+32768,O[a+768>>0]=-11059*a,O[a+1024>>0]=-21709*a,O[a+1280>>0]=32768*a+8421375,O[a+1536>>0]=-27439*a,O[a+1792>>0]=-5329*a}function g(a){for(var b=a[0],c=a[1]-1;c>=0;)b&1<<c&&(I|=1<<J),c--,J--,0>J&&(255==I?(h(255),h(0)):h(I),J=7,I=0)}function h(a){H.push(N[a])}function i(a){h(a>>8&255),h(255&a)}function j(a,b){var c,d,e,f,g,h,i,j,k,l=0;const m=8,n=64;for(k=0;m>k;++k){c=a[l],d=a[l+1],e=a[l+2],f=a[l+3],g=a[l+4],h=a[l+5],i=a[l+6],j=a[l+7];var o=c+j,p=c-j,q=d+i,r=d-i,s=e+h,t=e-h,u=f+g,v=f-g,w=o+u,x=o-u,y=q+s,z=q-s;a[l]=w+y,a[l+4]=w-y;var A=.707106781*(z+x);a[l+2]=x+A,a[l+6]=x-A,w=v+t,y=t+r,z=r+p;var B=.382683433*(w-z),C=.5411961*w+B,D=1.306562965*z+B,E=.707106781*y,G=p+E,H=p-E;a[l+5]=H+C,a[l+3]=H-C,a[l+1]=G+D,a[l+7]=G-D,l+=8}for(l=0,k=0;m>k;++k){c=a[l],d=a[l+8],e=a[l+16],f=a[l+24],g=a[l+32],h=a[l+40],i=a[l+48],j=a[l+56];var I=c+j,J=c-j,K=d+i,L=d-i,M=e+h,N=e-h,O=f+g,P=f-g,Q=I+O,R=I-O,S=K+M,T=K-M;a[l]=Q+S,a[l+32]=Q-S;var U=.707106781*(T+R);a[l+16]=R+U,a[l+48]=R-U,Q=P+N,S=N+L,T=L+J;var V=.382683433*(Q-T),W=.5411961*Q+V,X=1.306562965*T+V,Y=.707106781*S,Z=J+Y,$=J-Y;a[l+40]=$+W,a[l+24]=$-W,a[l+8]=Z+X,a[l+56]=Z-X,l++}var _;for(k=0;n>k;++k)_=a[k]*b[k],F[k]=_>0?_+.5|0:_-.5|0;return F}function k(){i(65504),i(16),h(74),h(70),h(73),h(70),h(0),h(1),h(1),h(0),i(1),i(1),h(0),h(0)}function l(a,b){i(65472),i(17),h(8),i(b),i(a),h(3),h(1),h(17),h(0),h(2),h(17),h(1),h(3),h(17),h(1)}function m(){i(65499),i(132),h(0);for(var a=0;64>a;a++)h(z[a]);h(1);for(var b=0;64>b;b++)h(A[b])}function n(){i(65476),i(418),h(0);for(var a=0;16>a;a++)h(Q[a+1]);for(var b=0;11>=b;b++)h(R[b]);h(16);for(var c=0;16>c;c++)h(S[c+1]);for(var d=0;161>=d;d++)h(T[d]);h(1);for(var e=0;16>e;e++)h(U[e+1]);for(var f=0;11>=f;f++)h(V[f]);h(17);for(var g=0;16>g;g++)h(W[g+1]);for(var j=0;161>=j;j++)h(X[j])}function o(){i(65498),i(12),h(3),h(1),h(0),h(2),h(17),h(3),h(17),h(0),h(63),h(0)}function p(a,b,c,d,e){var f,h=e[0],i=e[240];const k=16,l=63,m=64;for(var n=j(a,b),o=0;m>o;++o)G[P[o]]=n[o];var p=G[0]-c;c=G[0],0==p?g(d[0]):(f=32767+p,g(d[E[f]]),g(D[f]));for(var q=63;q>0&&0==G[q];q--);if(0==q)return g(h),c;for(var r,s=1;q>=s;){for(var t=s;0==G[s]&&q>=s;++s);var u=s-t;if(u>=k){r=u>>4;for(var v=1;r>=v;++v)g(i);u=15&u}f=32767+G[s],g(e[(u<<4)+E[f]]),g(D[f]),s++}return q!=l&&g(h),c}function q(){for(var a=String.fromCharCode,b=0;256>b;b++)N[b]=a(b)}function r(a){if(0>=a&&(a=1),a>100&&(a=100),x!=a){var c=0;c=50>a?Math.floor(5e3/a):Math.floor(200-2*a),b(c),x=a,console.log("Quality set to: "+a+"%")}}function s(){var b=(new Date).getTime();a||(a=50),q(),d(),e(),f(),r(a);var c=(new Date).getTime()-b;console.log("Initialization "+c+"ms")}var t,u,v,w,x,y=(Math.round,Math.floor),z=new Array(64),A=new Array(64),B=new Array(64),C=new Array(64),D=new Array(65535),E=new Array(65535),F=new Array(64),G=new Array(64),H=[],I=0,J=7,K=new Array(64),L=new Array(64),M=new Array(64),N=new Array(256),O=new Array(2048),P=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Q=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],R=[0,1,2,3,4,5,6,7,8,9,10,11],S=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],T=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],U=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],V=[0,1,2,3,4,5,6,7,8,9,10,11],W=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],X=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(a,b){var c=(new Date).getTime();b&&r(b),H=new Array,I=0,J=7,i(65496),k(),m(),l(a.width,a.height),n(),o();var d=0,e=0,f=0;I=0,J=7,this.encode.displayName="_encode_";for(var h,j,q,s,x,y,z,A,D,E=a.data,F=a.width,G=a.height,N=4*F,P=0;G>P;){for(h=0;N>h;){for(x=N*P+h,y=x,z=-1,A=0,D=0;64>D;D++)A=D>>3,z=4*(7&D),y=x+A*N+z,P+A>=G&&(y-=N*(P+1+A-G)),h+z>=N&&(y-=h+z-N+4),j=E[y++],q=E[y++],s=E[y++],K[D]=(O[j]+O[q+256>>0]+O[s+512>>0]>>16)-128,L[D]=(O[j+768>>0]+O[q+1024>>0]+O[s+1280>>0]>>16)-128,M[D]=(O[j+1280>>0]+O[q+1536>>0]+O[s+1792>>0]>>16)-128;d=p(K,B,d,t,v),e=p(L,C,e,u,w),f=p(M,C,f,u,w),h+=32}P+=8}if(J>=0){var Q=[];Q[1]=J+1,Q[0]=(1<<J+1)-1,g(Q)}i(65497);var R="data:image/jpeg;base64,"+btoa(H.join(""));H=[];var S=(new Date).getTime()-c;return console.log("Encoding time: "+S+"ms"),R},s()}function getImageDataFromImage(a){var b="string"==typeof a?document.getElementById(a):a,c=document.createElement("canvas");c.width=b.width,c.height=b.height;var d=c.getContext("2d");return d.drawImage(b,0,0),d.getImageData(0,0,c.width,c.height)}!function(){"use strict";var a,b={extend:function(a,b){var c;for(c in b)a[c]=b[c];return a},rotate:function(a,b,c,d,e){var f;6==e||8==e?(a.width=d,a.height=c):(a.width=c,a.height=d);var f=a.getContext("2d");6==e?(f.translate(d,0),f.rotate(Math.PI/2)):8==e?(f.translate(0,c),f.rotate(270*Math.PI/180)):3==e&&(f.translate(c,d),f.rotate(Math.PI)),f.drawImage(b,0,0)}};a=function(a){this.callbackFuns=["onSelect","onDelete","onProgress","onSuccess","onFailure","onComplete","onMessage","onCheck"],this.defBoundary="--image-someboundary--",this.defParams={file:null,uploadUrl:null,maxWidth:0,maxHeight:0,inputName:"file",imageQuality:100,httpBoundary:this.defBoundary,async:!0},this.msg={101:"无法获取file控件",102:"无法获取file文件内容",103:"浏览器无法使用xhr.upload对象"},this.index=0,this.p=b.extend(this.defParams,a),this.p.maxWidth=parseInt(this.p.maxWidth),this.p.maxHeight=parseInt(this.p.maxHeight),this.filesFilter=[],this.filesName=[],this.init()},a.prototype={constructor:a,init:function(a){var b,c;for(b in this.callbackFuns)c=this.callbackFuns[b],"function"==typeof this.p[c]?this.constructor.prototype[c]=this.p[c]:this.constructor.prototype[c]=function(){}},onMessage:function(a,b){console.log(a+"---"+b)},doUpload:function(){var a,b;if("object"!=typeof this.p.file||null===this.p.file)return this.onMessage(101,this.msg[101]),!1;if(a=this.p.file.files,a.length<1)return this.onMessage("102",this.msg[102]),!1;for(b=0;b<a.length;b++)this.isRepeat(a[b])||("image/jpeg"===a[b].type&&this.p.maxWidth>0&&this.p.maxHeight>0?this.compressImage(this.index,a[b]):this.uploading(this.index,a[b]),this.onSelect(this.index,a[b]),this.index++)},compressImage:function(a,c){var d=this,e=new FileReader,f=document.createElement("img");e.readAsDataURL(c),e.onload=function(a){f.src=this.result},f.onload=function(){var e=0,g=0,h=new MegaPixImage(c),i=1,j=document.createElement("img");f.width<d.p.maxWidth&&f.height<d.p.maxHeight?(e=f.width,g=f.height):f.width/d.p.maxWidth>f.height/d.p.maxHeight?(e=d.p.maxWidth,g=parseInt(f.height*d.p.maxWidth/f.width)):(e=parseInt(f.width*d.p.maxHeight/f.height),g=d.p.maxHeight),h.render(j,{maxWidth:e,maxHeight:g}),EXIF.getData(c,function(){i=EXIF.getTag(this,"Orientation"),j.onload=function(){var f=document.createElement("canvas"),h=f.getContext("2d"),k="";b.rotate(f,j,e,g,i),k=6==i||8==i?h.getImageData(0,0,g,e):h.getImageData(0,0,e,g),d.uploading(a,c,k,d.p.httpBoundary)}})}},uploading:function(a,b,c,d){var e,f,g=this;if(this.p.async===!0?f=new XMLHttpRequest:("undefined"==typeof this.xhr&&(this.xhr=new XMLHttpRequest),f=this.xhr),!f.upload)return this.onMessage(103,this.msg[103]),!1;if(f.upload.addEventListener("progress",function(c){g.onProgress(a,b,c.loaded,c.total)}),f.onreadystatechange=function(c){4==f.readyState&&(200==f.status?(g.onSuccess(a,b,f.responseText),g.deleteFile(b),g.filesFilter.length||g.onComplete()):g.onFailure(a,b,f.responseText))},f.open("POST",this.p.uploadUrl,this.p.async===!1?!1:!0),"undefined"==typeof c||""===c)e=new FormData,e.append("file",b),f.send(e);else{d=d||this.p.defBoundary,void 0===XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(a){var b=Array.prototype.map.call(a,function(a){return 255&a.charCodeAt(0)});this.send(new Uint8Array(b).buffer)});var h=new JPEGEncoder(this.p.imageQuality),i=h.encode(c,this.p.imageQuality);c=i.substr(23),f.setRequestHeader("Content-Type","multipart/form-data; boundary="+d),f.sendAsBinary(["--"+d,'Content-Disposition: form-data; name="'+this.p.inputName+'"; filename="'+b.name+'"',"Content-Type: "+b.type,"",atob(c),"--"+d+"--"].join("\r\n"))}},isRepeat:function(a){var b,c=!1;for(b=0;b<=this.filesName.length;b++)this.filesName[b]===a.name&&(c=!0);return this.onCheck(a)&&c?!0:(this.filesName.push(a.name),this.filesFilter.push(a.name),!1)},deleteFile:function(a){var b,c=this.filesFilter;for(b=0;b<=c.length;b++)if(c[b]===a.name)return this.filesFilter.splice(b,1),!0},onCheck:function(a){return!0}},window.CUI=a}(),function(){function a(a){var b=a.naturalWidth,c=a.naturalHeight;if(b*c>1048576){var d=document.createElement("canvas");d.width=d.height=1;var e=d.getContext("2d");return e.drawImage(a,-b+1,0),0===e.getImageData(0,0,1,1).data[3]}return!1}function b(a,b,c){var d=document.createElement("canvas");d.width=1,d.height=c;var e=d.getContext("2d");e.drawImage(a,0,0);for(var f=e.getImageData(0,0,1,c).data,g=0,h=c,i=c;i>g;){var j=f[4*(i-1)+3];0===j?h=i:g=i,i=h+g>>1}var k=i/c;return 0===k?1:k}function c(a,b,c){var e=document.createElement("canvas");return d(a,e,b,c),e.toDataURL("image/jpeg",b.quality||.8)}function d(c,d,f,g){var h=c.naturalWidth,i=c.naturalHeight,j=f.width,k=f.height,l=d.getContext("2d");l.save(),e(d,j,k,f.orientation);var m=a(c);m&&(h/=2,i/=2);var n=1024,o=document.createElement("canvas");o.width=o.height=n;for(var p=o.getContext("2d"),q=g?b(c,h,i):1,r=Math.ceil(n*j/h),s=Math.ceil(n*k/i/q),t=0,u=0;i>t;){for(var v=0,w=0;h>v;)p.clearRect(0,0,n,n),p.drawImage(c,-v,-t),l.drawImage(o,0,0,n,n,w,u,r,s),v+=n,w+=r;t+=n,u+=s}l.restore(),o=p=null}function e(a,b,c,d){switch(d){case 5:case 6:case 7:case 8:a.width=c,a.height=b;break;default:a.width=b,a.height=c}var e=a.getContext("2d");switch(d){case 2:e.translate(b,0),e.scale(-1,1);break;case 3:e.translate(b,c),e.rotate(Math.PI);break;case 4:e.translate(0,c),e.scale(1,-1);break;case 5:e.rotate(.5*Math.PI),e.scale(1,-1);break;case 6:e.rotate(.5*Math.PI),e.translate(0,-c);break;case 7:e.rotate(.5*Math.PI),e.translate(b,-c),e.scale(-1,1);break;case 8:e.rotate(-.5*Math.PI),e.translate(-b,0)}}function f(a){if(window.Blob&&a instanceof Blob){var b=new Image,c=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!c)throw Error("No createObjectURL function found to create blob url");b.src=c.createObjectURL(a),this.blob=a,a=b}if(!a.naturalWidth&&!a.naturalHeight){var d=this;a.onload=function(){var a=d.imageLoadListeners;if(a){d.imageLoadListeners=null;for(var b=0,c=a.length;c>b;b++)a[b]()}},this.imageLoadListeners=[]}this.srcImage=a}f.prototype.render=function(a,b){if(this.imageLoadListeners){var e=this;return void this.imageLoadListeners.push(function(){e.render(a,b)})}b=b||{};var f=this.srcImage.naturalWidth,g=this.srcImage.naturalHeight,h=b.width,i=b.height,j=b.maxWidth,k=b.maxHeight,l=!this.blob||"image/jpeg"===this.blob.type;h&&!i?i=g*h/f<<0:i&&!h?h=f*i/g<<0:(h=f,i=g),j&&h>j&&(h=j,i=g*h/f<<0),k&&i>k&&(i=k,h=f*i/g<<0);var m={width:h,height:i};for(var n in b)m[n]=b[n];var o=a.tagName.toLowerCase();"img"===o?a.src=c(this.srcImage,m,l):"canvas"===o&&d(this.srcImage,a,m,l),"function"==typeof this.onrender&&this.onrender(a)},"function"==typeof define&&define.amd?define([],function(){return f}):this.MegaPixImage=f}();var EXIF=function(){function a(a){return!!a.exifdata}function b(a,b){function d(d){var e=c(d);a.exifdata=e||{},b&&b.call(a)}if(a instanceof Image||a instanceof HTMLImageElement)BinaryAjax(a.src,function(a){d(a.binaryResponse)});else if(window.FileReader&&a instanceof window.File){var e=new FileReader;e.onload=function(a){m&&console.log("Got file of length "+a.target.result.byteLength),d(a.target.result)},e.readAsArrayBuffer(a)}}function c(a){var b=new DataView(a);if(m&&console.log("Got file of length "+a.byteLength),255!=b.getUint8(0)||216!=b.getUint8(1))return m&&console.log("Not a valid JPEG"),!1;for(var c,d=2,e=a.byteLength;e>d;){if(255!=b.getUint8(d))return m&&console.log("Not a valid marker at offset "+d+", found: "+a.getByteAt(d)),!1;if(c=b.getUint8(d+1),m&&console.log(c),225==c)return m&&console.log("Found 0xFFE1 marker"),g(b,d+4,b.getUint16(d+2)-2);d+=2+b.getUint16(d+2)}}function d(a,b,c,d,f){var g,h,i,j=a.getUint16(c,!f),k={};for(i=0;j>i;i++)g=c+12*i+2,h=d[a.getUint16(g,!f)],!h&&m&&console.log("Unknown tag: "+a.getUint16(g,!f)),k[h]=e(a,g,b,c,f);return k}function e(a,b,c,d,e){var g,h,i,j,k,l,m=a.getUint16(b+2,!e),n=a.getUint32(b+4,!e),o=a.getUint32(b+8,!e)+c;switch(m){case 1:case 7:if(1==n)return a.getUint8(b+8,!e);for(g=n>4?o:b+8,h=[],j=0;n>j;j++)h[j]=a.getUint8(g+j);return h;case 2:return g=n>4?o:b+8,f(a,g,n-1);case 3:if(1==n)return a.getUint16(b+8,!e);for(g=n>2?o:b+8,h=[],j=0;n>j;j++)h[j]=a.getUint16(g+2*j,!e);return h;case 4:if(1==n)return a.getUint32(b+8,!e);h=[];for(var j=0;n>j;j++)h[j]=a.getUint32(o+4*j,!e);return h;case 5:if(1==n)return k=a.getUint32(o,!e),l=a.getUint32(o+4,!e),i=new Number(k/l),i.numerator=k,i.denominator=l,i;for(h=[],j=0;n>j;j++)k=a.getUint32(o+8*j,!e),l=a.getUint32(o+4+8*j,!e),h[j]=new Number(k/l),h[j].numerator=k,h[j].denominator=l;return h;case 9:if(1==n)return a.getInt32(b+8,!e);for(h=[],j=0;n>j;j++)h[j]=a.getInt32(o+4*j,!e);return h;case 10:if(1==n)return a.getInt32(o,!e)/a.getInt32(o+4,!e);for(h=[],j=0;n>j;j++)h[j]=a.getInt32(o+8*j,!e)/a.getInt32(o+4+8*j,!e);return h}}function f(a,b,c){var d="";for(n=b;n<b+c;n++)d+=String.fromCharCode(a.getUint8(n));return d}function g(a,b){if("Exif"!=f(a,b,4))return m&&console.log("Not valid EXIF data! "+f(a,b,4)),!1;var c,e,g,h,i,j=b+6;if(18761==a.getUint16(j))c=!1;else{if(19789!=a.getUint16(j))return m&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;c=!0}if(42!=a.getUint16(j+2,!c))return m&&console.log("Not valid TIFF data! (no 0x002A)"),!1;if(8!=a.getUint32(j+4,!c))return m&&console.log("Not valid TIFF data! (First offset not 8)",a.getUint16(j+4,!c)),!1;if(e=d(a,j,j+8,p,c),e.ExifIFDPointer){h=d(a,j,j+e.ExifIFDPointer,o,c);for(g in h){switch(g){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":h[g]=r[g][h[g]];break;case"ExifVersion":case"FlashpixVersion":h[g]=String.fromCharCode(h[g][0],h[g][1],h[g][2],h[g][3]);break;case"ComponentsConfiguration":h[g]=r.Components[h[g][0]]+r.Components[h[g][1]]+r.Components[h[g][2]]+r.Components[h[g][3]]}e[g]=h[g]}}if(e.GPSInfoIFDPointer){i=d(a,j,j+e.GPSInfoIFDPointer,q,c);for(g in i){switch(g){case"GPSVersionID":i[g]=i[g][0]+"."+i[g][1]+"."+i[g][2]+"."+i[g][3]}e[g]=i[g]}}return e}function h(c,d){return(c instanceof Image||c instanceof HTMLImageElement)&&!c.complete?!1:(a(c)?d&&d.call(c):b(c,d),!0)}function i(b,c){return a(b)?b.exifdata[c]:void 0}function j(b){if(!a(b))return{};var c,d=b.exifdata,e={};for(c in d)d.hasOwnProperty(c)&&(e[c]=d[c]);return e}function k(b){if(!a(b))return"";var c,d=b.exifdata,e="";for(c in d)d.hasOwnProperty(c)&&(e+="object"==typeof d[c]?d[c]instanceof Number?c+" : "+d[c]+" ["+d[c].numerator+"/"+d[c].denominator+"]\r\n":c+" : ["+d[c].length+" values]\r\n":c+" : "+d[c]+"\r\n");return e}function l(a){return c(a)}var m=!1,o={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},p={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},q={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},r={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};return{readFromBinaryFile:l,pretty:k,getTag:i,getAllTags:j,getData:h,Tags:o,TiffTags:p,GPSTags:q,StringValues:r}}(),BinaryFile=function(a,b,c){var d=a,e=b||0,f=0;this.getRawData=function(){return d},"string"==typeof a?(f=c||d.length,this.getByteAt=function(a){return 255&d.charCodeAt(a+e)},this.getBytesAt=function(a,b){for(var c=[],f=0;b>f;f++)c[f]=255&d.charCodeAt(a+f+e);return c}):"unknown"==typeof a&&(f=c||IEBinary_getLength(d),this.getByteAt=function(a){return IEBinary_getByteAt(d,a+e)},this.getBytesAt=function(a,b){return new VBArray(IEBinary_getBytesAt(d,a+e,b)).toArray()}),this.getLength=function(){return f},this.getSByteAt=function(a){var b=this.getByteAt(a);return b>127?b-256:b},this.getShortAt=function(a,b){var c=b?(this.getByteAt(a)<<8)+this.getByteAt(a+1):(this.getByteAt(a+1)<<8)+this.getByteAt(a);return 0>c&&(c+=65536),c},this.getSShortAt=function(a,b){var c=this.getShortAt(a,b);return c>32767?c-65536:c},this.getLongAt=function(a,b){var c=this.getByteAt(a),d=this.getByteAt(a+1),e=this.getByteAt(a+2),f=this.getByteAt(a+3),g=b?(((c<<8)+d<<8)+e<<8)+f:(((f<<8)+e<<8)+d<<8)+c;return 0>g&&(g+=4294967296),g},this.getSLongAt=function(a,b){var c=this.getLongAt(a,b);return c>2147483647?c-4294967296:c},this.getStringAt=function(a,b){for(var c=[],d=this.getBytesAt(a,b),e=0;b>e;e++)c[e]=String.fromCharCode(d[e]);return c.join("")},this.getCharAt=function(a){return String.fromCharCode(this.getByteAt(a))},this.toBase64=function(){return window.btoa(d)},this.fromBase64=function(a){d=window.atob(a)}},BinaryAjax=function(){function a(){var a=null;return window.ActiveXObject?a=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(a=new XMLHttpRequest),a}function b(b,c,d){var e=a();e?(c&&("undefined"!=typeof e.onload?e.onload=function(){"200"==e.status?c(this):d&&d(),e=null}:e.onreadystatechange=function(){4==e.readyState&&("200"==e.status?c(this):d&&d(),e=null)}),e.open("HEAD",b,!0),e.send(null)):d&&d()}function c(b,c,d,e,f,g){var h=a();if(h){var i=0;e&&!f&&(i=e[0]);var j=0;e&&(j=e[1]-e[0]+1),c&&("undefined"!=typeof h.onload?h.onload=function(){"200"==h.status||"206"==h.status||"0"==h.status?(h.binaryResponse=new BinaryFile(h.responseText,i,j),h.fileSize=g||h.getResponseHeader("Content-Length"),c(h)):d&&d(),h=null}:h.onreadystatechange=function(){if(4==h.readyState){if("200"==h.status||"206"==h.status||"0"==h.status){var a={status:h.status,binaryResponse:new BinaryFile("unknown"==typeof h.responseBody?h.responseBody:h.responseText,i,j),fileSize:g||h.getResponseHeader("Content-Length")};c(a)}else d&&d();h=null}}),h.open("GET",b,!0),h.overrideMimeType&&h.overrideMimeType("text/plain; charset=x-user-defined"),e&&f&&h.setRequestHeader("Range","bytes="+e[0]+"-"+e[1]),h.setRequestHeader("If-Modified-Since","Sat, 1 Jan 1970 00:00:00 GMT"),h.send(null)}else d&&d()}return function(a,d,e,f){f?b(a,function(b){var g,h,i=parseInt(b.getResponseHeader("Content-Length"),10),j=b.getResponseHeader("Accept-Ranges");g=f[0],f[0]<0&&(g+=i),h=g+f[1]-1,c(a,d,e,[g,h],"bytes"==j,i)}):c(a,d,e)}}();document.write("<script type='text/vbscript'>\r\nFunction IEBinary_getByteAt(strBinary, iOffset)\r\n	IEBinary_getByteAt = AscB(MidB(strBinary, iOffset + 1, 1))\r\nEnd Function\r\nFunction IEBinary_getBytesAt(strBinary, iOffset, iLength)\r\n  Dim aBytes()\r\n  ReDim aBytes(iLength - 1)\r\n  For i = 0 To iLength - 1\r\n   aBytes(i) = IEBinary_getByteAt(strBinary, iOffset + i)\r\n  Next\r\n  IEBinary_getBytesAt = aBytes\r\nEnd Function\r\nFunction IEBinary_getLength(strBinary)\r\n	IEBinary_getLength = LenB(strBinary)\r\nEnd Function\r\n</script>\r\n");